---
const { path } = Astro.props;
---

<div class="giscus-wrapper">
  <script
    src="https://giscus.app/client.js"
    data-repo="Sixday-C/SixdayC"
    data-repo-id="R_kgDOORlROQ"
    data-category="General"
    data-category-id="DIC_kwDOORlROc4CxYtx"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    data-loading="lazy"
    crossorigin="anonymous"
    async
  ></script>
</div>

<!-- 主题切换脚本 -->
<script is:inline>
  // 页面加载时同步主题
  function updateGiscusTheme() {
    const iframe = document.querySelector("iframe.giscus-frame");
    if (!iframe) return;

    const theme = document.documentElement.getAttribute("data-theme") === "dark" 
      ? "dark" 
      : "light";

    iframe.contentWindow.postMessage(
      { giscus: { setConfig: { theme } } },
      "https://giscus.app"
    );
  }

  // 监听主题切换
  document.addEventListener("astro:page-load", () => {
    // 等待 iframe 加载完成
    setTimeout(updateGiscusTheme, 1000);

    // 监听主题变化
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (
          mutation.type === "attributes" &&
          mutation.attributeName === "data-theme"
        ) {
          updateGiscusTheme();
        }
      });
    });

    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ["data-theme"],
    });
  });
</script>

<style>
  .giscus-wrapper {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid var(--fallback-bc, oklch(var(--bc) / 0.1));
  }

  /* 适配暗色主题 */
  [data-theme="dark"] .giscus-wrapper {
    border-top-color: var(--fallback-bc, oklch(var(--bc) / 0.2));
  }

  /* 响应式调整 */
  @media (max-width: 768px) {
    .giscus-wrapper {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
    }
  }
</style>
